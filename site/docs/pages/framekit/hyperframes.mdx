# HyperFrames

HyperFrames are a data structure that makes it easy to create and organize large numbers of cross-linked Farcaster frames.

## Usage

With Next.js App routing, start inside `page.ts`. Create your first frame as normal, but be sure to add a query parameter to the `postUrl` called `frame` with a value containing the name of the first frame, such as `start`:

```typescript
const frameMetadata = getFrameMetadata({ // [!code word:start]
  buttons: [
    {
      label: 'Road',
    },
    {
      label: 'Woods',
    },
    {
      label: 'Cave',
    },
    {
      action: 'link',
      label: 'TODO',
      target: 'https://www.google.com',
    },
  ],
  image: {
    src: `${NEXT_PUBLIC_URL}/frame-1-forest.webp`,
    aspectRatio: '1:1',
  },
  postUrl: `${NEXT_PUBLIC_URL}/api/frame?frame=start`, // [!code highlight]
});
```

Next, in `api/route.ts`, or another file and imported there, add this frame to the `frames` array with `addHyperFrame:

```typescript
import { addHyperFrame } from '../../hyperframes';
addHyperFrame('start', { // [!code word:start]
  frame: getFrameHtmlResponse({
    buttons: [
      {
        label: 'Road',
      },
      {
        label: 'Woods',
      },
      {
        label: 'Cave',
      },
    ],
    image: {
      src: `${NEXT_PUBLIC_URL}/frame-1-forest.webp`,
      aspectRatio: '1:1',
    },
    postUrl: `${NEXT_PUBLIC_URL}/api/frame?frame=start`, // [!code highlight]
  }),
  1: 'road',
  2: 'woods-bear',
  3: 'cave-1',
});
```

Again, the `postUrl` for each frame must contain a query parameter called `frame` with a value containing the name of the frame.

The numbered properties correspond with the name of the HyperFrame that should be returned when that button is clicked.

Add additional frames in the same way.

```typescript
addHyperFrame('cave-1', { // [!code word:cave-1]
  frame: getFrameHtmlResponse({
    buttons: [
      {
        label: 'Go Back',
      },
      
    ],
    image: {
      src: `${NEXT_PUBLIC_URL}/cave.webp`,
      aspectRatio: '1:1',
    },
    postUrl: `${NEXT_PUBLIC_URL}/api/frame?frame=cave-1`, // [!code highlight]
  }),
  1: 'start',
});
```

The second frame will be displayed with the user clicks the `Cave` button in the first frame.  It contains a single button, 'Go Back', which will return the user to the first frame.

The `getResponse` function must extract the query parameter `frame` from the request. It then performs the usual validation, and returns `getHyperFrame`, called with the name of the frame from the query parameter, the frame `text`, and the button pressed by the user.

```typescript
async function getResponse(req: NextRequest): Promise<NextResponse> {
  const url = new URL(req.url); // [!code focus]
  const queryParams = url.searchParams; // [!code focus]
  const frame = queryParams.get('frame'); // [!code focus]

  let accountAddress: string | undefined = '';
  let text: string | undefined = '';

  const body: FrameRequest = await req.json();
  const { isValid, message } = await getFrameMessage(body, {
    neynarApiKey: 'NEYNAR_ONCHAIN_KIT'
  });

  if (isValid) {
    accountAddress = message.interactor.verified_accounts[0];
  }

  if (message?.input) {
    text = message.input;
  }

  if (!frame) { // [!code focus]
    return new NextResponse('Frame name not provided in postUrl', {
      status: 404
    }); // [!code focus]
  } // [!code focus]

  // There should always be a button number
  if (!message?.button) {
    return new NextResponse('Button not found', { status: 404 });
  }

  return new NextResponse(
    getHyperFrame(frame as string, text || '', message?.button)
  ); // [!code focus]
}
```
